<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="managerMapper">

<resultMap type="Member" id="member_rm">
		<id property="memberNo" column="MEMBER_NO"/>
		<result property="memberUrl" column="MEMBER_URL"/>
		<result property="memberNickname" column="MEMBER_NICKNAME"/>
		<result property="memberEmail" column="MEMBER_EMAIL"/>
		<result property="enrollDate" column="ENROLL_DATE"/>
</resultMap>

<resultMap type="Board" id="board_rm">
		<id property="boardNo" column="BOARD_NO"/>
		<result property="boardContent" column="BOARD_CONTENT"/>
		<result property="boardDate" column="BOARD_DATE"/>
		<result property="boardDelFl" column="BOARD_DEL_FL"/>
		<result property="memberNo" column="MEMBER_NO"/>
		<result property="memberUrl" column="MEMBER_URL"/>
		<result property="declarationCount" column="DECLARATION_COUNT"/>
</resultMap>
<resultMap type="Comment" id="comment_rm">
		<id property="commentNo" column="COMMENT_NO"/>
		<result property="boardNo" column="BOARD_NO"/>
		<result property="memberUrl" column="MEMBER_URL"/>
		<result property="commentContent" column="COMMENT_CONTENT"/>
		<result property="commentDelFl" column="COMMENT_DEL_FL"/>
</resultMap>
<resultMap type="Inquiry" id="inquiry_rm">
		<id property="inquiryNo" column="INQUIRY_NO"/>
		<result property="memberUrl" column="MEMBER_URL"/>
		<result property="inquiryContent" column="INQUIRY_CONTENT"/>
		<result property="memberEmail" column="MEMBER_EMAIL"/>
</resultMap>
<resultMap type="Declaration" id="declaration_rm">
		<id property="indictmentNo" column="INDICTMENT_NO"/>
		<result property="memberUrl" column="MEMBER_URL"/>
		<result property="boardNo" column="BOARD_NO"/>
		<result property="indictmentContent" column="INDICTMENT_CONTENT"/>
</resultMap>
<!-- 가입 회원 목록 조회 -->
<select id="selectMemberList" resultMap="member_rm">
SELECT MEMBER_NO,MEMBER_URL,MEMBER_NICKNAME,MEMBER_EMAIL,ENROLL_DATE
FROM "MEMBER"
WHERE MEMBER_DEL_FL = 'N'
</select>

<!-- 탈퇴 회원 목록 조회 -->
<select id="selectSecessionList" resultMap="member_rm">
SELECT MEMBER_NO,MEMBER_URL,MEMBER_NICKNAME,MEMBER_EMAIL,ENROLL_DATE
FROM "MEMBER"
WHERE MEMBER_DEL_FL = 'Y'
</select>

<!-- 게시글 목록 조회 -->
<select id="selectBoardList" resultMap="board_rm">
SELECT BOARD_NO,MEMBER_URL,BOARD_CONTENT,BOARD_DEL_FL,
(SELECT COUNT(*) FROM DECLARATION D WHERE D.BOARD_NO = B.BOARD_NO) DECLARATION_COUNT
FROM "BOARD" B
JOIN "MEMBER" USING (MEMBER_NO)
ORDER BY BOARD_NO DESC
</select>

<!-- 댓글 목록 조회 -->
<select id="selectCommentList" resultMap="comment_rm">
SELECT COMMENT_NO , BOARD_NO , COMMENT_CONTENT,MEMBER_URL ,COMMENT_DEL_FL 
FROM "COMMENT"
JOIN "MEMBER" ON(COMMENT_MEMBER_NO = MEMBER_NO)
</select>

<!-- 1:1 문의 목록 조회 -->
<select id="selectInquiryList" resultMap="inquiry_rm">
SELECT INQUIRY_NO, MEMBER_URL , INQUIRY_CONTENT,MEMBER_EMAIL
FROM INQUIRY
JOIN "MEMBER" USING (MEMBER_NO)
</select>

<!-- 신고 목록 조회 -->

<select id="selectDeclarationList" resultMap="declaration_rm">
SELECT INDICTMENT_NO ,MEMBER_URL ,BOARD_NO , INDICTMENT_CONTENT
FROM DECLARATION d
JOIN "MEMBER" M USING(MEMBER_NO)
</select>

<!-- 회원 탈퇴 처리 -->
<update id="updateId" parameterType="int">
	UPDATE "MEMBER" SET
	MEMBER_DEL_FL = 'Y'
	WHERE MEMBER_NO = #{memberNo}
</update>

<!-- 탈퇴 회원 복구 -->
<update id="restoreId" parameterType="int">
	UPDATE "MEMBER" SET
	MEMBER_DEL_FL = 'N'
	WHERE MEMBER_NO = #{memberNo}
</update>

<!-- 게시글 삭제 -->
<update id="deletePost" parameterType="int">
	UPDATE "BOARD" SET
	BOARD_DEL_FL = 'Y'
	WHERE BOARD_NO = #{boardNo}
</update>

<!-- 게시글 복구 -->
<update id="restorePost" parameterType="int">
	UPDATE "BOARD" SET
	BOARD_DEL_FL = 'N'
	WHERE BOARD_NO = #{boardNo}
</update>

</mapper>
